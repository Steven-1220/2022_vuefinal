"use strict";(self["webpackChunke_commerce_dessert"]=self["webpackChunke_commerce_dessert"]||[]).push([[307],{1307:function(e,o,t){t.r(o),t.d(o,{default:function(){return ie}});var n=t(3396),l=t(7139);const s=(0,n._)("h2",{class:"text-center pt-4"},"優惠券",-1),a={class:"container"},d={class:"text-end mt-4"},i={class:"table mt-4"},p=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",null,"名稱"),(0,n._)("th",null,"折扣百分比"),(0,n._)("th",null,"到期日"),(0,n._)("th",null,"是否啟用"),(0,n._)("th",null,"編輯")])],-1),u={key:0},c={key:1,class:"text-muted"},r={class:"btn-group"},m=["onClick"],h=["onClick"];function b(e,o,t,b,_,C){const f=(0,n.up)("VueLoading"),v=(0,n.up)("CouponModal"),g=(0,n.up)("DeleteCouponModal");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)(f,{active:_.isLoading},null,8,["active"]),s,(0,n._)("div",a,[(0,n._)("div",d,[(0,n._)("button",{class:"btn btn-primary",type:"button",onClick:o[0]||(o[0]=e=>C.openModal("new"))}," 建立新的優惠券 ")]),(0,n._)("table",i,[p,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(_.coupons,(e=>((0,n.wg)(),(0,n.iD)("tr",{key:e.id},[(0,n._)("td",null,(0,l.zw)(e.title),1),(0,n._)("td",null,(0,l.zw)(e.percent)+"%",1),(0,n._)("td",null,(0,l.zw)(new Date(1e3*e.due_date).toLocaleDateString()),1),(0,n._)("td",null,[e.is_enabled?((0,n.wg)(),(0,n.iD)("span",u,"啟用")):((0,n.wg)(),(0,n.iD)("span",c,"未啟用"))]),(0,n._)("td",null,[(0,n._)("div",r,[(0,n._)("button",{type:"button",class:"btn btn-outline-success btn-sm",onClick:o=>C.openModal("edit",e)}," 編輯 ",8,m),(0,n._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:o=>C.openModal("delete",e)}," 刪除 ",8,h)])])])))),128))])])]),(0,n.Wm)(v,{coupon:_.tempCoupon,"is-new":_.isNew,onUpdateCoupon:C.updateCoupon,ref:"couponModalRef"},null,8,["coupon","is-new","onUpdateCoupon"]),(0,n.Wm)(g,{"delete-coupon-item":_.tempCoupon,onGetCoupons:C.getCoupon,ref:"delCouponModalRef"},null,8,["delete-coupon-item","onGetCoupons"])],64)}var _=t(9242);const C={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalRef"},f={class:"modal-dialog",role:"document"},v={class:"modal-content"},g={class:"modal-header"},w={class:"modal-title",id:"exampleModalLabel"},y={key:0},M={key:1},k=(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),$={class:"modal-body"},x={class:"mb-3"},D=(0,n._)("label",{for:"title"},"標題",-1),N={class:"mb-3"},S=(0,n._)("label",{for:"coupon_code"},"優惠碼",-1),L={class:"mb-3"},U=(0,n._)("label",{for:"due_date"},"到期日",-1),R={class:"mb-3"},V=(0,n._)("label",{for:"price"},"折扣百分比",-1),O={class:"mb-3"},z={class:"form-check"},I=(0,n._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),J={class:"modal-footer"},P=(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1);function W(e,o,t,l,s,a){return(0,n.wg)(),(0,n.iD)("div",C,[(0,n._)("div",f,[(0,n._)("div",v,[(0,n._)("div",g,[(0,n._)("h5",w,[t.isNew?((0,n.wg)(),(0,n.iD)("span",y,"新增優惠卷")):((0,n.wg)(),(0,n.iD)("span",M,"編輯優惠卷"))]),k]),(0,n._)("div",$,[(0,n._)("div",x,[D,(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":o[0]||(o[0]=e=>s.tempCoupon.title=e)},null,512),[[_.nr,s.tempCoupon.title]])]),(0,n._)("div",N,[S,(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[1]||(o[1]=e=>s.tempCoupon.code=e)},null,512),[[_.nr,s.tempCoupon.code]])]),(0,n._)("div",L,[U,(0,n.wy)((0,n._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=e=>s.due_date=e)},null,512),[[_.nr,s.due_date]])]),(0,n._)("div",R,[V,(0,n.wy)((0,n._)("input",{type:"number",class:"form-control",id:"price",min:"0",placeholder:"請輸入折扣百分比","onUpdate:modelValue":o[3]||(o[3]=e=>s.tempCoupon.percent=e)},null,512),[[_.nr,s.tempCoupon.percent]])]),(0,n._)("div",O,[(0,n._)("div",z,[(0,n.wy)((0,n._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":o[4]||(o[4]=e=>s.tempCoupon.is_enabled=e)},null,512),[[_.e8,s.tempCoupon.is_enabled]]),I])])]),(0,n._)("div",J,[P,(0,n._)("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=o=>e.$emit("update-coupon",s.tempCoupon))}," 確定 ")])])])],512)}var Z=t(7972),G=t.n(Z),H={data(){return{couponModal:{},tempCoupon:{},due_date:""}},props:{coupon:{},isNew:{type:Boolean,default:!1}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const e=new Date(1e3*this.tempCoupon.due_date),o=e.toISOString().split("T")[0];this.due_date=o},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{open(){this.couponModal.show()},close(){this.couponModal.hide()}},mounted(){this.couponModal=new(G())(this.$refs.modalRef,{keyboard:!1})}},T=t(89);const Y=(0,T.Z)(H,[["render",W]]);var B=Y;const K={id:"delProductModal",ref:"delModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},j={class:"modal-dialog"},q={class:"modal-content border-0"},A=(0,n._)("div",{class:"modal-header bg-danger text-white"},[(0,n._)("h5",{id:"delProductModalLabel",class:"modal-title"},[(0,n._)("span",null,"刪除優惠券")]),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),E={class:"modal-body"},F=(0,n.Uk)(" 是否刪除 "),Q={class:"text-danger"},X=(0,n.Uk)(" 優惠券(刪除後將無法恢復)。 "),ee={class:"modal-footer"},oe=(0,n._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function te(e,o,t,s,a,d){return(0,n.wg)(),(0,n.iD)("div",K,[(0,n._)("div",j,[(0,n._)("div",q,[A,(0,n._)("div",E,[F,(0,n._)("strong",Q,(0,l.zw)(t.deleteCouponItem.title),1),X]),(0,n._)("div",ee,[oe,(0,n._)("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...e)=>d.deleteCoupon&&d.deleteCoupon(...e))}," 確認刪除 ")])])])],512)}var ne={data(){return{delCouponModal:{}}},props:["deleteCouponItem"],methods:{open(){this.delCouponModal.show()},close(){this.delCouponModal.hide()},deleteCoupon(){this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/coupon/${this.deleteCouponItem.id}`).then((e=>{this.$emit("get-coupons"),this.$httpMessageState(e,"刪除優惠券"),this.close()})).catch((e=>{console.log(e.data),this.$httpMessageState(e.response,"刪除優惠券")}))}},mounted(){this.delCouponModal=new(G())(this.$refs.delModal,{keyboard:!1})}};const le=(0,T.Z)(ne,[["render",te]]);var se=le,ae={components:{CouponModal:B,DeleteCouponModal:se},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:50,code:""},isNew:!1,isLoading:!1}},methods:{getCoupon(){this.isLoading=!0;const e="https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/coupons";this.$http.get(e,this.tempProduct).then((e=>{this.coupons=e.data.coupons,this.isLoading=!1})).catch((e=>{console.log(e.data)}))},openModal(e,o){console.log(e,o),"new"==e?(this.tempCoupon={due_date:(new Date).getTime()/1e3},this.$refs.couponModalRef.open(),this.isNew=!0):"edit"==e?(this.tempCoupon=JSON.parse(JSON.stringify(o)),this.$refs.couponModalRef.open(),this.isNew=!1):"delete"==e&&(this.tempCoupon=JSON.parse(JSON.stringify(o)),this.$refs.delCouponModalRef.open())},updateCoupon(){let e="https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/coupon",o="post",t="新增優惠券";this.isNew||(e=`https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/coupon/${this.tempCoupon.id}`,o="put",t="更新優惠券"),this.$http[o](e,{data:this.tempCoupon}).then((e=>{this.getCoupon(),this.$httpMessageState(e,t),this.$refs.couponModalRef.close()})).catch((e=>{console.log(e.response),this.$httpMessageState(e.response,t)}))}},mounted(){this.getCoupon()}};const de=(0,T.Z)(ae,[["render",b]]);var ie=de}}]);
//# sourceMappingURL=307.34848fa3.js.map