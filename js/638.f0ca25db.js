"use strict";(self["webpackChunke_commerce_dessert"]=self["webpackChunke_commerce_dessert"]||[]).push([[638],{1835:function(e,t,l){l.d(t,{Z:function(){return h}});var d=l(3396),a=l(7139),s=l(9242);const r={"aria-label":"Page navigation",class:"mb-5"},o={class:"pagination justify-content-center"},n=["onClick"];function i(e,t,l,i,c,u){return(0,d.wg)(),(0,d.iD)("nav",r,[(0,d._)("ul",o,[(0,d._)("li",{class:(0,a.C_)(["page-item",{disabled:!l.pages.has_pre}])},[(0,d._)("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=(0,s.iM)((e=>u.emitChangePage(l.pages.current_page-1)),["prevent"]))},"前一頁")],2),((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(l.pages.total_pages,(e=>((0,d.wg)(),(0,d.iD)("li",{class:(0,a.C_)(["page-item",{active:e===l.pages.current_page}]),key:e+"123"},[(0,d._)("a",{class:"page-link",href:"#",onClick:(0,s.iM)((t=>u.emitChangePage(e)),["prevent"])},(0,a.zw)(e),9,n)],2)))),128)),(0,d._)("li",{class:(0,a.C_)(["page-item",{disabled:!l.pages.has_next}])},[(0,d._)("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=(0,s.iM)((e=>u.emitChangePage(l.pages.current_page+1)),["prevent"]))},"下一頁")],2)])])}var c=l(7897),u={props:["pages"],methods:{emitChangePage(e){this.$emit("emit-get-page",e),c.Z.emit("toggle-menu")}}},p=l(89);const _=(0,p.Z)(u,[["render",i]]);var h=_},2638:function(e,t,l){l.r(t),l.d(t,{default:function(){return Je}});var d=l(3396),a=l(7139);const s=(0,d._)("h2",{class:"text-center pt-4"},"訂單",-1),r={class:"container"},o={class:"row py-3"},n={class:"col"},i={class:"text-end mt-4"},c={class:"table mt-4"},u=(0,d._)("thead",null,[(0,d._)("tr",null,[(0,d._)("th",{width:"120"},"購買時間"),(0,d._)("th",{width:"120"},"Email"),(0,d._)("th",{width:"120"},"購買款項"),(0,d._)("th",{width:"120"},"應付金額"),(0,d._)("th",{width:"120"},"是否付款"),(0,d._)("th",{width:"120"},"編輯")])],-1),p={id:"productList"},_={class:"list-unstyled"},h={class:"text-secondary"},m={key:0,class:"text-success"},g={key:1,class:"text-danger"},b={class:"btn-group"},w=["onClick"],O=["onClick"],v=(0,d.Uk)(" 本頁面有 "),y={id:"productCount"},k=(0,d.Uk)(" 筆訂單 ");function f(e,t,l,f,D,M){const x=(0,d.up)("VueLoading"),C=(0,d.up)("PaginationView"),z=(0,d.up)("OrderModal"),A=(0,d.up)("DeleteOrderModal");return(0,d.wg)(),(0,d.iD)(d.HY,null,[(0,d.Wm)(x,{active:D.isLoading},null,8,["active"]),s,(0,d._)("div",r,[(0,d._)("div",o,[(0,d._)("div",n,[(0,d._)("div",i,[(0,d._)("button",{class:"btn btn-warning",onClick:t[0]||(t[0]=e=>M.openModal("deleteAllOrder"))}," 刪除所有訂單 ")]),(0,d._)("table",c,[u,(0,d._)("tbody",p,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(D.orders,(e=>((0,d.wg)(),(0,d.iD)("tr",{key:e.id},[(0,d._)("td",null,(0,a.zw)(new Date(1e3*e.create_at).toLocaleDateString()),1),(0,d._)("td",null,(0,a.zw)(e.user.email),1),(0,d._)("td",null,[(0,d._)("ul",_,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(e.products,((e,t)=>((0,d.wg)(),(0,d.iD)("li",{key:t},[(0,d._)("span",h,(0,a.zw)(e.product.title),1),(0,d.Uk)(" 數量 : "+(0,a.zw)(e.qty)+" "+(0,a.zw)(e.product.unit),1)])))),128))])]),(0,d._)("td",null,(0,a.zw)(e.total),1),(0,d._)("td",null,[e.is_paid?((0,d.wg)(),(0,d.iD)("span",m,"已付款")):((0,d.wg)(),(0,d.iD)("span",g,"未付款"))]),(0,d._)("td",null,[(0,d._)("div",b,[(0,d._)("button",{type:"button",class:"btn btn-outline-success btn-sm",onClick:t=>M.openModal("edit",e)}," 檢視 ",8,w),(0,d._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:t=>M.openModal("delete",e)}," 刪除 ",8,O)])])])))),128))])]),(0,d._)("p",null,[v,(0,d._)("span",y,(0,a.zw)(D.orders.length),1),k])])]),(0,d.Wm)(C,{pages:D.pagination,onEmitGetPage:M.getAllOrders},null,8,["pages","onEmitGetPage"]),(0,d.Wm)(z,{"order-mod":D.tempOrder,onUpdateOrder:M.updateOrderState,ref:"orderModalRef"},null,8,["order-mod","onUpdateOrder"]),(0,d.Wm)(A,{"delete-order-item":D.tempOrder,"is-all-orders":D.isAllOrders,onGetOrders:M.getAllOrders,ref:"delModalRef"},null,8,["delete-order-item","is-all-orders","onGetOrders"])])],64)}var D=l(1835),M=l(9242);const x={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modalRef"},C={class:"modal-dialog modal-xl",role:"document"},z={class:"modal-content border-0"},A=(0,d._)("div",{class:"modal-header bg-dark text-white"},[(0,d._)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,d._)("span",null,"訂單細節")]),(0,d._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),$={class:"modal-body"},L={class:"row"},P={class:"col-md-4"},S=(0,d._)("h3",null,"用戶資料",-1),R={class:"table"},U={key:0},Z=(0,d._)("th",{style:{width:"100px"}},"姓名",-1),N=(0,d._)("th",null,"Email",-1),H=(0,d._)("th",null,"電話",-1),Y=(0,d._)("th",null,"地址",-1),E={class:"col-md-8"},G=(0,d._)("h3",null,"訂單細節",-1),J={class:"table"},K=(0,d._)("th",{style:{width:"100px"}},"訂單編號",-1),V=(0,d._)("th",null,"下單時間",-1),W=(0,d._)("th",null,"付款時間",-1),q={key:0},j={key:1},I=(0,d._)("th",null,"付款狀態",-1),B={key:0,class:"text-success"},F={key:1,class:"text-muted"},Q=(0,d._)("th",null,"總金額",-1),T=(0,d._)("h3",null,"選購商品",-1),X={class:"table"},ee=(0,d._)("thead",null,[(0,d._)("tr")],-1),te={class:"text-end"},le={class:"d-flex justify-content-end"},de={class:"form-check"},ae={class:"form-check-label",for:"flexCheckDefault"},se={key:0},re={key:1},oe={class:"modal-footer"},ne=(0,d._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ie(e,t,l,s,r,o){return(0,d.wg)(),(0,d.iD)("div",x,[(0,d._)("div",C,[(0,d._)("div",z,[A,(0,d._)("div",$,[(0,d._)("div",L,[(0,d._)("div",P,[S,(0,d._)("table",R,[r.tempOrder.user?((0,d.wg)(),(0,d.iD)("tbody",U,[(0,d._)("tr",null,[Z,(0,d._)("td",null,(0,a.zw)(r.tempOrder.user.name),1)]),(0,d._)("tr",null,[N,(0,d._)("td",null,(0,a.zw)(r.tempOrder.user.email),1)]),(0,d._)("tr",null,[H,(0,d._)("td",null,(0,a.zw)(r.tempOrder.user.tel),1)]),(0,d._)("tr",null,[Y,(0,d._)("td",null,(0,a.zw)(r.tempOrder.user.address),1)])])):(0,d.kq)("",!0)])]),(0,d._)("div",E,[G,(0,d._)("table",J,[(0,d._)("tbody",null,[(0,d._)("tr",null,[K,(0,d._)("td",null,(0,a.zw)(r.tempOrder.id),1)]),(0,d._)("tr",null,[V,(0,d._)("td",null,(0,a.zw)(new Date(1e3*r.tempOrder.create_at).toLocaleDateString()),1)]),(0,d._)("tr",null,[W,(0,d._)("td",null,[r.tempOrder.paid_date?((0,d.wg)(),(0,d.iD)("span",q,(0,a.zw)(new Date(1e3*r.tempOrder.paid_date).toLocaleDateString()),1)):((0,d.wg)(),(0,d.iD)("span",j,"時間不正確"))])]),(0,d._)("tr",null,[I,(0,d._)("td",null,[r.tempOrder.is_paid?((0,d.wg)(),(0,d.iD)("strong",B,"已付款")):((0,d.wg)(),(0,d.iD)("span",F,"尚未付款"))])]),(0,d._)("tr",null,[Q,(0,d._)("td",null,(0,a.zw)(r.tempOrder.total),1)])])]),T,(0,d._)("table",X,[ee,(0,d._)("tbody",null,[((0,d.wg)(!0),(0,d.iD)(d.HY,null,(0,d.Ko)(r.tempOrder.products,(e=>((0,d.wg)(),(0,d.iD)("tr",{key:e.id},[(0,d._)("th",null,(0,a.zw)(e.product.title),1),(0,d._)("td",null,(0,a.zw)(e.qty)+" / "+(0,a.zw)(e.product.unit),1),(0,d._)("td",te,(0,a.zw)(e.final_total),1)])))),128))])]),(0,d._)("div",le,[(0,d._)("div",de,[(0,d.wy)((0,d._)("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":t[0]||(t[0]=e=>r.tempOrder.is_paid=e)},null,512),[[M.e8,r.tempOrder.is_paid]]),(0,d._)("label",ae,[r.tempOrder.is_paid?((0,d.wg)(),(0,d.iD)("span",se,"已付款")):((0,d.wg)(),(0,d.iD)("span",re,"未付款"))])])])])])]),(0,d._)("div",oe,[ne,(0,d._)("button",{type:"button",class:"btn btn-primary",onClick:t[1]||(t[1]=t=>e.$emit("update-order",r.tempOrder))}," 修改付款狀態 ")])])])],512)}var ce=l(7972),ue=l.n(ce),pe={data(){return{orderModal:{},tempOrder:{},isPaid:!1}},props:{orderMod:{}},emits:["update-order"],watch:{orderMod(){this.tempOrder=this.orderMod}},methods:{open(){this.orderModal.show()},close(){this.orderModal.hide()}},mounted(){this.orderModal=new(ue())(this.$refs.modalRef,{keyboard:!1})}},_e=l(89);const he=(0,_e.Z)(pe,[["render",ie]]);var me=he;const ge={id:"delProductModal",ref:"delModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},be={class:"modal-dialog"},we={class:"modal-content border-0"},Oe={class:"modal-header bg-danger text-white"},ve={id:"delProductModalLabel",class:"modal-title"},ye={key:0},ke={key:1},fe=(0,d._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),De={key:0,class:"modal-body"},Me=(0,d._)("strong",{class:"text-danger"},"是否刪除",-1),xe=(0,d.Uk)(" 所有訂單(刪除後將無法恢復)。 "),Ce=[Me,xe],ze={key:1,class:"modal-body"},Ae=(0,d._)("strong",{class:"text-danger"},"是否刪除",-1),$e=(0,d.Uk)(" 該筆訂單(刪除後將無法恢復)。 "),Le=[Ae,$e],Pe={class:"modal-footer"},Se=(0,d._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Re={key:0},Ue={key:1};function Ze(e,t,l,a,s,r){return(0,d.wg)(),(0,d.iD)("div",ge,[(0,d._)("div",be,[(0,d._)("div",we,[(0,d._)("div",Oe,[(0,d._)("h5",ve,[l.isAllOrders?((0,d.wg)(),(0,d.iD)("span",ye,"刪除所有訂單")):((0,d.wg)(),(0,d.iD)("span",ke,"刪除訂單"))]),fe]),l.isAllOrders?((0,d.wg)(),(0,d.iD)("div",De,Ce)):((0,d.wg)(),(0,d.iD)("div",ze,Le)),(0,d._)("div",Pe,[Se,l.isAllOrders?((0,d.wg)(),(0,d.iD)("div",Re,[(0,d._)("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...e)=>r.deleteAllOrder&&r.deleteAllOrder(...e))}," 刪除所有訂單 ")])):((0,d.wg)(),(0,d.iD)("div",Ue,[(0,d._)("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=(...e)=>r.deleteOrder&&r.deleteOrder(...e))}," 確認刪除 ")]))])])])],512)}var Ne={data(){return{delOrderModal:""}},props:{deleteOrderItem:{},isAllOrders:{type:Boolean,default:!1}},methods:{open(){this.delOrderModal.show()},close(){this.delOrderModal.hide()},deleteOrder(){this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/order/${this.deleteOrderItem.id}`).then((()=>{this.$emit("get-orders"),this.close()})).catch((e=>{console.log(e.response.data)}))},deleteAllOrder(){this.$http.delete("https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/orders/all").then((()=>{this.$emit("get-orders"),this.close()})).catch((e=>{console.log(e.response.data)}))}},mounted(){this.delOrderModal=new(ue())(this.$refs.delModal,{keyboard:!1})}};const He=(0,_e.Z)(Ne,[["render",Ze]]);var Ye=He,Ee={components:{PaginationView:D.Z,OrderModal:me,DeleteOrderModal:Ye},data(){return{orders:[],pagination:{},tempOrder:{},isNew:!1,isLoading:!1,isAllOrders:!1}},methods:{getAllOrders(e=1){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/orders/?page=${e}`;this.$http.get(t).then((e=>{this.orders=e.data.orders,this.pagination=e.data.pagination,this.isLoading=!1})).catch((e=>{console.log(e.data)}))},openModal(e,t){console.log(e,t),"edit"==e?(this.tempOrder=JSON.parse(JSON.stringify(t)),this.$refs.orderModalRef.open(),this.isNew=!1):"delete"==e?(this.tempOrder=JSON.parse(JSON.stringify(t)),this.isAllOrders=!1,this.$refs.delModalRef.open()):"deleteAllOrder"==e&&(this.isAllOrders=!0,this.$refs.delModalRef.open())},updateOrderState(e){const t=`https://vue3-course-api.hexschool.io/v2/api/steven1220/admin/order/${e.id}`,l={is_paid:e.is_paid};this.$http.put(t,{data:l}).then((e=>{this.getAllOrders(),this.$httpMessageState(e,"已更新付款狀態"),this.$refs.orderModalRef.close()})).catch((e=>{console.log(e.data)}))}},mounted(){this.getAllOrders()}};const Ge=(0,_e.Z)(Ee,[["render",f]]);var Je=Ge}}]);
//# sourceMappingURL=638.f0ca25db.js.map